package com.abc.userservices.services;

import static org.junit.jupiter.api.Assertions.assertEquals;
import static org.mockito.Mockito.mock;
import static org.mockito.Mockito.when;

import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.security.authentication.AuthenticationManager;
import org.springframework.security.authentication.UsernamePasswordAuthenticationToken;
import org.springframework.security.core.Authentication;
import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;

import com.abc.userservices.config.JwtTokenProvider;
import com.abc.userservices.model.Login;
import com.abc.userservices.repository.UserRepository;
import com.abc.userservices.service.AuthServiceImpl;

@SpringBootTest
public class AuthServiceImplTest {

	 @InjectMocks 
	 private AuthServiceImpl authService;
	 
	@Mock 
	private AuthenticationManager authenticationManager;
    
	@Mock 
    private JwtTokenProvider jwtTokenProvider;
    
	@Mock 
	private BCryptPasswordEncoder passwordEncoder;
    
	@Mock 
	private UserRepository userRepository;
	
    @Test
    void testLogin() {
        String expectedToken = "token123";
        Login login = new Login("user@example.com", "password");

        Authentication authentication = mock(Authentication.class);
        when(authenticationManager.authenticate(usernamePasswordAuthenticationToken)).thenReturn(authentication);
        when(jwtTokenProvider.generateToken(authentication)).thenReturn(expectedToken);

        String result = authService.login(login);

        assertEquals(expectedToken, result);
    }

   
}
